<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>RouteFinder</title>
	<style>
		.window {
			  margin: 0 auto;
			  display:block;
			  width: 40%;
			  height: 50%;
		}
		#input_group * {display:inline!important;}
		#output {
			border: 1px solid cyan;
		}
		#output > * {
			color: green;
		}
		#output_ping, #output_domain {
			color: red;
		}
	</style>
</head>
<body>
	<div class="window">
		<form id="input_group" onsubmit="start(domain.value); return false">
			<span><h4>Input domain name:</h3><input type="text" name="domain"></span>
			<input type="submit" value="find paths">
		</form>
		<div id="output">
			<h3>Domain: <span id="output_domain">0</span></h3>
			<h3>Ping: <span id="output_ping">0</span></h3>
			<h3>PATHS:</h3>
			<div id="output_paths"></div>
		</div>
	</div>

	<script>
		//vars
		let _domain = {id: "output_domain", value: "default domain"};
		let _ping = {id: "output_ping", value: "default ping"};
		//proxies
		const domain = new Proxy(_domain, {set: (t,p,v)=>{ t[p] = v; render(_domain); return true;} })
		const ping = new Proxy(_ping, {set: (t,p,v)=>{ t[p] = v; render(_ping); return true;} });

		function render(el){
			document.getElementById(el.id).innerHTML = el.value;
		}

		function pingPlotter(){
			const time = ()=> new Date().getTime();
			let start = time();
			let finish;
			let estimate;

			this.start = function(){
				start = time();
			}
			this.finish = function(){
				finish = time();
				estimate = finish - start;
				return this;
			}
			this.getResult = function (){
				return estimate;
			}
		}
		function request(theUrl, callback){
		    var xmlHttp = new XMLHttpRequest();
		    xmlHttp.onreadystatechange = function() { 
	            callback(xmlHttp.status);
		    }
		    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
		    xmlHttp.send(null);
		}
		function mesurePing(url){
			return new Promise((ok,notok)=>{
				const plotter = new pingPlotter();
				request(url, (code)=>{
					console.log(code);
					ping = plotter.finish().getResult();
					ok();
				});
			})
		}
		function start(input){
			domain.value = input;
			mesurePing(domain.value);
		}

		// const test = new pingPlotter();
		// setTimeout(()=>{ping.value = test.finish().getResult()}, 2000);
	</script>
</body>
</html>
